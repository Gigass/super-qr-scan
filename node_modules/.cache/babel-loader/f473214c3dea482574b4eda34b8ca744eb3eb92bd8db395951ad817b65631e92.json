{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { detectAndDecode, drawDetectionResult, getImageDataFromFile, preloadOpenCV } from './utils/qrDetector';\nexport default {\n  name: 'App',\n  data() {\n    return {\n      // 模式：camera | upload\n      mode: 'camera',\n      // 摄像头状态\n      cameraActive: false,\n      mediaStream: null,\n      // 拍照\n      capturedImage: false,\n      // 上传\n      uploadedImage: false,\n      isDragOver: false,\n      // 检测结果\n      detectionResult: null,\n      noQRFound: false,\n      // 状态\n      isLoading: false,\n      errorMessage: ''\n    };\n  },\n  methods: {\n    /**\n     * 切换模式\n     */\n    switchMode(newMode) {\n      if (this.mode === newMode) return;\n\n      // 清理当前状态\n      if (this.mode === 'camera') {\n        this.stopCamera();\n      }\n      this.mode = newMode;\n      this.clearResults();\n      if (newMode === 'upload') {\n        this.clearUpload();\n      }\n    },\n    /**\n     * 启动摄像头\n     */\n    async startCamera() {\n      this.clearResults();\n      this.errorMessage = '';\n      try {\n        const constraints = {\n          video: {\n            facingMode: 'environment',\n            // 优先使用后置摄像头\n            width: {\n              ideal: 1280\n            },\n            height: {\n              ideal: 720\n            }\n          }\n        };\n        this.mediaStream = await navigator.mediaDevices.getUserMedia(constraints);\n        const video = this.$refs.videoRef;\n        video.srcObject = this.mediaStream;\n        await new Promise(resolve => {\n          video.onloadedmetadata = () => {\n            video.play();\n            resolve();\n          };\n        });\n        this.cameraActive = true;\n      } catch (error) {\n        console.error('摄像头启动失败:', error);\n        if (error.name === 'NotAllowedError') {\n          this.errorMessage = '摄像头访问被拒绝，请在浏览器设置中允许访问摄像头';\n        } else if (error.name === 'NotFoundError') {\n          this.errorMessage = '未找到可用的摄像头设备';\n        } else if (error.name === 'NotReadableError') {\n          this.errorMessage = '摄像头正被其他应用占用';\n        } else {\n          this.errorMessage = `摄像头启动失败: ${error.message}`;\n        }\n      }\n    },\n    /**\n     * 停止摄像头\n     */\n    stopCamera() {\n      if (this.mediaStream) {\n        this.mediaStream.getTracks().forEach(track => track.stop());\n        this.mediaStream = null;\n      }\n      const video = this.$refs.videoRef;\n      if (video) {\n        video.srcObject = null;\n      }\n      this.cameraActive = false;\n      this.capturedImage = false;\n      this.clearResults();\n    },\n    /**\n     * 拍照并检测\n     */\n    async capturePhoto() {\n      const video = this.$refs.videoRef;\n      const canvas = this.$refs.canvasRef;\n      if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\n        this.errorMessage = '视频流未就绪，请稍后重试';\n        return;\n      }\n      this.isLoading = true;\n      this.clearResults();\n      try {\n        // 设置 canvas 尺寸\n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n        const ctx = canvas.getContext('2d');\n\n        // 绘制视频帧到 canvas\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n        // 获取图像数据\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n        // 检测二维码（异步）\n        const result = await detectQRCode(imageData);\n        if (result) {\n          this.detectionResult = result;\n          // 绘制检测结果\n          drawDetectionResult(ctx, result);\n        } else {\n          this.noQRFound = true;\n        }\n        this.capturedImage = true;\n      } catch (error) {\n        console.error('检测失败:', error);\n        this.errorMessage = '检测过程中发生错误';\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    /**\n     * 重拍\n     */\n    retake() {\n      this.capturedImage = false;\n      this.clearResults();\n    },\n    /**\n     * 触发文件选择\n     */\n    triggerFileInput() {\n      this.$refs.fileInputRef?.click();\n    },\n    /**\n     * 处理文件选择\n     */\n    async handleFileSelect(event) {\n      const file = event.target.files?.[0];\n      if (file) {\n        await this.processImageFile(file);\n      }\n      // 清空 input 以便重复选择同一文件\n      event.target.value = '';\n    },\n    /**\n     * 处理拖拽放下\n     */\n    async handleDrop(event) {\n      this.isDragOver = false;\n      const file = event.dataTransfer.files?.[0];\n      if (file && file.type.startsWith('image/')) {\n        await this.processImageFile(file);\n      } else {\n        this.errorMessage = '请上传有效的图片文件';\n      }\n    },\n    /**\n     * 处理图片文件\n     */\n    async processImageFile(file) {\n      this.isLoading = true;\n      this.clearResults();\n      try {\n        const {\n          imageData,\n          width,\n          height,\n          imageSrc\n        } = await getImageDataFromFile(file);\n        const canvas = this.$refs.uploadCanvasRef;\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n\n        // 先绘制原图\n        const img = new Image();\n        await new Promise((resolve, reject) => {\n          img.onload = resolve;\n          img.onerror = reject;\n          img.src = imageSrc;\n        });\n        ctx.drawImage(img, 0, 0);\n\n        // 检测二维码（异步）\n        const result = await detectQRCode(imageData);\n        if (result) {\n          this.detectionResult = result;\n          // 绘制检测结果\n          drawDetectionResult(ctx, result);\n        } else {\n          this.noQRFound = true;\n        }\n        this.uploadedImage = true;\n      } catch (error) {\n        console.error('图片处理失败:', error);\n        this.errorMessage = '图片处理失败，请尝试其他图片';\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    /**\n     * 清除上传\n     */\n    clearUpload() {\n      this.uploadedImage = false;\n      this.clearResults();\n      const canvas = this.$refs.uploadCanvasRef;\n      if (canvas) {\n        const ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n    },\n    /**\n     * 清除检测结果\n     */\n    clearResults() {\n      this.detectionResult = null;\n      this.noQRFound = false;\n      this.errorMessage = '';\n    }\n  },\n  mounted() {\n    // 预加载 OpenCV.js\n    preloadOpenCV().catch(err => {\n      console.warn('OpenCV.js 预加载失败:', err);\n    });\n  },\n  beforeDestroy() {\n    this.stopCamera();\n  }\n};","map":{"version":3,"names":["detectAndDecode","drawDetectionResult","getImageDataFromFile","preloadOpenCV","name","data","mode","cameraActive","mediaStream","capturedImage","uploadedImage","isDragOver","detectionResult","noQRFound","isLoading","errorMessage","methods","switchMode","newMode","stopCamera","clearResults","clearUpload","startCamera","constraints","video","facingMode","width","ideal","height","navigator","mediaDevices","getUserMedia","$refs","videoRef","srcObject","Promise","resolve","onloadedmetadata","play","error","console","message","getTracks","forEach","track","stop","capturePhoto","canvas","canvasRef","readyState","HAVE_ENOUGH_DATA","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","result","detectQRCode","retake","triggerFileInput","fileInputRef","click","handleFileSelect","event","file","target","files","processImageFile","value","handleDrop","dataTransfer","type","startsWith","imageSrc","uploadCanvasRef","img","Image","reject","onload","onerror","src","clearRect","mounted","catch","err","warn","beforeDestroy"],"sources":["src/App.vue"],"sourcesContent":["<template>\n  <div class=\"app-container\">\n    <!-- 顶部标题栏 -->\n    <header class=\"app-header glass\">\n      <div class=\"header-content\">\n        <div class=\"logo\">\n          <svg class=\"logo-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\"/>\n            <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\"/>\n            <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\"/>\n            <rect x=\"14\" y=\"14\" width=\"4\" height=\"4\"/>\n            <rect x=\"18\" y=\"18\" width=\"3\" height=\"3\"/>\n          </svg>\n          <h1 class=\"logo-text\">QR Locator</h1>\n        </div>\n        <p class=\"header-subtitle\">精准定位图像中的二维码位置</p>\n      </div>\n    </header>\n\n    <!-- 主内容区 -->\n    <main class=\"app-main\">\n      <!-- 模式切换 -->\n      <div class=\"mode-switcher\">\n        <button \n          :class=\"['mode-btn', { active: mode === 'camera' }]\"\n          @click=\"switchMode('camera')\"\n        >\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"/>\n            <circle cx=\"12\" cy=\"13\" r=\"4\"/>\n          </svg>\n          <span>摄像头</span>\n        </button>\n        <button \n          :class=\"['mode-btn', { active: mode === 'upload' }]\"\n          @click=\"switchMode('upload')\"\n        >\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n            <polyline points=\"17 8 12 3 7 8\"/>\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\n          </svg>\n          <span>上传图片</span>\n        </button>\n      </div>\n\n      <!-- 摄像头模式 -->\n      <div v-show=\"mode === 'camera'\" class=\"camera-section\">\n        <div class=\"video-container\">\n          <!-- 视频预览 -->\n          <video \n            ref=\"videoRef\"\n            class=\"video-preview\"\n            autoplay\n            playsinline\n            muted\n          ></video>\n          \n          <!-- 扫描框叠加层 -->\n          <div v-if=\"cameraActive && !capturedImage\" class=\"scan-overlay\">\n            <div class=\"scan-frame\">\n              <div class=\"scan-corner top-left\"></div>\n              <div class=\"scan-corner top-right\"></div>\n              <div class=\"scan-corner bottom-left\"></div>\n              <div class=\"scan-corner bottom-right\"></div>\n              <div class=\"scan-line\"></div>\n            </div>\n          </div>\n\n          <!-- 拍照结果预览 -->\n          <canvas \n            ref=\"canvasRef\"\n            v-show=\"capturedImage\"\n            class=\"result-canvas\"\n          ></canvas>\n\n          <!-- 加载状态 -->\n          <div v-if=\"isLoading\" class=\"loading-overlay\">\n            <div class=\"loading-spinner\"></div>\n            <p>正在检测...</p>\n          </div>\n        </div>\n\n        <!-- 摄像头控制按钮 -->\n        <div class=\"camera-controls\">\n          <button \n            v-if=\"!cameraActive\"\n            class=\"btn-primary\"\n            @click=\"startCamera\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"20\" height=\"20\">\n              <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"/>\n              <circle cx=\"12\" cy=\"13\" r=\"4\"/>\n            </svg>\n            启动摄像头\n          </button>\n\n          <template v-else>\n            <button \n              v-if=\"!capturedImage\"\n              class=\"btn-primary capture-btn\"\n              @click=\"capturePhoto\"\n            >\n              <div class=\"capture-icon\"></div>\n            </button>\n\n            <div v-else class=\"result-controls\">\n              <button class=\"btn-secondary\" @click=\"retake\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"18\" height=\"18\">\n                  <polyline points=\"1 4 1 10 7 10\"/>\n                  <path d=\"M3.51 15a9 9 0 1 0 2.13-9.36L1 10\"/>\n                </svg>\n                重拍\n              </button>\n              <button class=\"btn-secondary\" @click=\"stopCamera\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"18\" height=\"18\">\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n                </svg>\n                关闭\n              </button>\n            </div>\n          </template>\n        </div>\n      </div>\n\n      <!-- 上传模式 -->\n      <div v-show=\"mode === 'upload'\" class=\"upload-section\">\n        <div \n          class=\"upload-area\"\n          :class=\"{ 'drag-over': isDragOver, 'has-image': uploadedImage }\"\n          @dragover.prevent=\"isDragOver = true\"\n          @dragleave=\"isDragOver = false\"\n          @drop.prevent=\"handleDrop\"\n          @click=\"triggerFileInput\"\n        >\n          <input \n            ref=\"fileInputRef\"\n            type=\"file\"\n            accept=\"image/*\"\n            @change=\"handleFileSelect\"\n            hidden\n          />\n\n          <!-- 上传提示 -->\n          <div v-if=\"!uploadedImage\" class=\"upload-hint\">\n            <div class=\"upload-icon\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n                <polyline points=\"17 8 12 3 7 8\"/>\n                <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\n              </svg>\n            </div>\n            <p class=\"upload-text\">拖拽图片到此处</p>\n            <p class=\"upload-subtext\">或点击选择文件</p>\n          </div>\n\n          <!-- 上传后的图片预览 -->\n          <canvas \n            ref=\"uploadCanvasRef\"\n            v-show=\"uploadedImage\"\n            class=\"upload-canvas\"\n          ></canvas>\n\n          <!-- 加载状态 -->\n          <div v-if=\"isLoading\" class=\"loading-overlay\">\n            <div class=\"loading-spinner\"></div>\n            <p>正在检测...</p>\n          </div>\n        </div>\n\n        <!-- 上传控制按钮 -->\n        <div v-if=\"uploadedImage\" class=\"upload-controls\">\n          <button class=\"btn-secondary\" @click=\"clearUpload\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"18\" height=\"18\">\n              <polyline points=\"3 6 5 6 21 6\"/>\n              <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\n            </svg>\n            清除\n          </button>\n          <button class=\"btn-primary\" @click=\"triggerFileInput\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"18\" height=\"18\">\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n              <polyline points=\"17 8 12 3 7 8\"/>\n              <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\n            </svg>\n            更换图片\n          </button>\n        </div>\n      </div>\n\n      <!-- 检测结果信息 -->\n      <div v-if=\"detectionResult\" class=\"result-info glass animate-fadeIn\">\n        <div class=\"result-header\">\n          <div class=\"result-status success\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"20\" height=\"20\">\n              <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n              <polyline points=\"22 4 12 14.01 9 11.01\"/>\n            </svg>\n            <span>检测成功</span>\n          </div>\n        </div>\n        \n        <!-- 二维码内容 -->\n        <div v-if=\"detectionResult.decoded\" class=\"qr-content\">\n          <h4>二维码内容</h4>\n          <div class=\"content-box\">\n            <p class=\"content-text\">{{ detectionResult.decoded.text }}</p>\n            <button class=\"btn-copy\" @click=\"copyContent(detectionResult.decoded.text)\">\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"16\" height=\"16\">\n                <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"/>\n                <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/>\n              </svg>\n              复制\n            </button>\n          </div>\n        </div>\n        <div v-else class=\"qr-content decode-failed\">\n          <h4>解码失败</h4>\n          <p>已定位到二维码，但无法解码内容</p>\n        </div>\n        \n        <div class=\"result-details\">\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">中心坐标</span>\n            <span class=\"detail-value\">\n              ({{ Math.round(detectionResult.center.x) }}, {{ Math.round(detectionResult.center.y) }})\n            </span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">尺寸</span>\n            <span class=\"detail-value\">\n              {{ Math.round(detectionResult.boundingBox.width) }} × {{ Math.round(detectionResult.boundingBox.height) }} px\n            </span>\n          </div>\n        </div>\n\n        <div class=\"corner-coords\">\n          <h4>角点坐标</h4>\n          <div class=\"coords-grid\">\n            <div class=\"coord-item\">\n              <span class=\"coord-label\">左上</span>\n              <span class=\"coord-value\">({{ Math.round(detectionResult.topLeft.x) }}, {{ Math.round(detectionResult.topLeft.y) }})</span>\n            </div>\n            <div class=\"coord-item\">\n              <span class=\"coord-label\">右上</span>\n              <span class=\"coord-value\">({{ Math.round(detectionResult.topRight.x) }}, {{ Math.round(detectionResult.topRight.y) }})</span>\n            </div>\n            <div class=\"coord-item\">\n              <span class=\"coord-label\">左下</span>\n              <span class=\"coord-value\">({{ Math.round(detectionResult.bottomLeft.x) }}, {{ Math.round(detectionResult.bottomLeft.y) }})</span>\n            </div>\n            <div class=\"coord-item\">\n              <span class=\"coord-label\">右下</span>\n              <span class=\"coord-value\">({{ Math.round(detectionResult.bottomRight.x) }}, {{ Math.round(detectionResult.bottomRight.y) }})</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 未检测到二维码 -->\n      <div v-if=\"noQRFound\" class=\"result-info glass animate-fadeIn\">\n        <div class=\"result-header\">\n          <div class=\"result-status error\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"20\" height=\"20\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n              <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/>\n              <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/>\n            </svg>\n            <span>未检测到二维码</span>\n          </div>\n        </div>\n        <p class=\"no-result-hint\">请确保图像中包含清晰可见的二维码</p>\n      </div>\n\n      <!-- 错误提示 -->\n      <div v-if=\"errorMessage\" class=\"error-message glass animate-fadeIn\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"20\" height=\"20\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\n        </svg>\n        <span>{{ errorMessage }}</span>\n      </div>\n    </main>\n\n    <!-- 底部信息 -->\n    <footer class=\"app-footer\">\n      <p>使用 OpenCV.js 定位 + ZXing 解码 | 完整的二维码识别方案</p>\n    </footer>\n  </div>\n</template>\n\n<script>\nimport { detectAndDecode, drawDetectionResult, getImageDataFromFile, preloadOpenCV } from './utils/qrDetector'\n\nexport default {\n  name: 'App',\n  \n  data() {\n    return {\n      // 模式：camera | upload\n      mode: 'camera',\n      \n      // 摄像头状态\n      cameraActive: false,\n      mediaStream: null,\n      \n      // 拍照\n      capturedImage: false,\n      \n      // 上传\n      uploadedImage: false,\n      isDragOver: false,\n      \n      // 检测结果\n      detectionResult: null,\n      noQRFound: false,\n      \n      // 状态\n      isLoading: false,\n      errorMessage: ''\n    }\n  },\n\n  methods: {\n    /**\n     * 切换模式\n     */\n    switchMode(newMode) {\n      if (this.mode === newMode) return\n      \n      // 清理当前状态\n      if (this.mode === 'camera') {\n        this.stopCamera()\n      }\n      \n      this.mode = newMode\n      this.clearResults()\n      \n      if (newMode === 'upload') {\n        this.clearUpload()\n      }\n    },\n\n    /**\n     * 启动摄像头\n     */\n    async startCamera() {\n      this.clearResults()\n      this.errorMessage = ''\n      \n      try {\n        const constraints = {\n          video: {\n            facingMode: 'environment', // 优先使用后置摄像头\n            width: { ideal: 1280 },\n            height: { ideal: 720 }\n          }\n        }\n        \n        this.mediaStream = await navigator.mediaDevices.getUserMedia(constraints)\n        \n        const video = this.$refs.videoRef\n        video.srcObject = this.mediaStream\n        \n        await new Promise((resolve) => {\n          video.onloadedmetadata = () => {\n            video.play()\n            resolve()\n          }\n        })\n        \n        this.cameraActive = true\n      } catch (error) {\n        console.error('摄像头启动失败:', error)\n        \n        if (error.name === 'NotAllowedError') {\n          this.errorMessage = '摄像头访问被拒绝，请在浏览器设置中允许访问摄像头'\n        } else if (error.name === 'NotFoundError') {\n          this.errorMessage = '未找到可用的摄像头设备'\n        } else if (error.name === 'NotReadableError') {\n          this.errorMessage = '摄像头正被其他应用占用'\n        } else {\n          this.errorMessage = `摄像头启动失败: ${error.message}`\n        }\n      }\n    },\n\n    /**\n     * 停止摄像头\n     */\n    stopCamera() {\n      if (this.mediaStream) {\n        this.mediaStream.getTracks().forEach(track => track.stop())\n        this.mediaStream = null\n      }\n      \n      const video = this.$refs.videoRef\n      if (video) {\n        video.srcObject = null\n      }\n      \n      this.cameraActive = false\n      this.capturedImage = false\n      this.clearResults()\n    },\n\n    /**\n     * 拍照并检测\n     */\n    async capturePhoto() {\n      const video = this.$refs.videoRef\n      const canvas = this.$refs.canvasRef\n      \n      if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\n        this.errorMessage = '视频流未就绪，请稍后重试'\n        return\n      }\n      \n      this.isLoading = true\n      this.clearResults()\n      \n      try {\n        // 设置 canvas 尺寸\n        canvas.width = video.videoWidth\n        canvas.height = video.videoHeight\n        \n        const ctx = canvas.getContext('2d')\n        \n        // 绘制视频帧到 canvas\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\n        \n        // 获取图像数据\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n        \n        // 检测二维码（异步）\n        const result = await detectQRCode(imageData)\n        \n        if (result) {\n          this.detectionResult = result\n          // 绘制检测结果\n          drawDetectionResult(ctx, result)\n        } else {\n          this.noQRFound = true\n        }\n        \n        this.capturedImage = true\n      } catch (error) {\n        console.error('检测失败:', error)\n        this.errorMessage = '检测过程中发生错误'\n      } finally {\n        this.isLoading = false\n      }\n    },\n\n    /**\n     * 重拍\n     */\n    retake() {\n      this.capturedImage = false\n      this.clearResults()\n    },\n\n    /**\n     * 触发文件选择\n     */\n    triggerFileInput() {\n      this.$refs.fileInputRef?.click()\n    },\n\n    /**\n     * 处理文件选择\n     */\n    async handleFileSelect(event) {\n      const file = event.target.files?.[0]\n      if (file) {\n        await this.processImageFile(file)\n      }\n      // 清空 input 以便重复选择同一文件\n      event.target.value = ''\n    },\n\n    /**\n     * 处理拖拽放下\n     */\n    async handleDrop(event) {\n      this.isDragOver = false\n      \n      const file = event.dataTransfer.files?.[0]\n      if (file && file.type.startsWith('image/')) {\n        await this.processImageFile(file)\n      } else {\n        this.errorMessage = '请上传有效的图片文件'\n      }\n    },\n\n    /**\n     * 处理图片文件\n     */\n    async processImageFile(file) {\n      this.isLoading = true\n      this.clearResults()\n      \n      try {\n        const { imageData, width, height, imageSrc } = await getImageDataFromFile(file)\n        \n        const canvas = this.$refs.uploadCanvasRef\n        canvas.width = width\n        canvas.height = height\n        \n        const ctx = canvas.getContext('2d')\n        \n        // 先绘制原图\n        const img = new Image()\n        await new Promise((resolve, reject) => {\n          img.onload = resolve\n          img.onerror = reject\n          img.src = imageSrc\n        })\n        ctx.drawImage(img, 0, 0)\n        \n        // 检测二维码（异步）\n        const result = await detectQRCode(imageData)\n        \n        if (result) {\n          this.detectionResult = result\n          // 绘制检测结果\n          drawDetectionResult(ctx, result)\n        } else {\n          this.noQRFound = true\n        }\n        \n        this.uploadedImage = true\n      } catch (error) {\n        console.error('图片处理失败:', error)\n        this.errorMessage = '图片处理失败，请尝试其他图片'\n      } finally {\n        this.isLoading = false\n      }\n    },\n\n    /**\n     * 清除上传\n     */\n    clearUpload() {\n      this.uploadedImage = false\n      this.clearResults()\n      \n      const canvas = this.$refs.uploadCanvasRef\n      if (canvas) {\n        const ctx = canvas.getContext('2d')\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\n      }\n    },\n\n    /**\n     * 清除检测结果\n     */\n    clearResults() {\n      this.detectionResult = null\n      this.noQRFound = false\n      this.errorMessage = ''\n    }\n  },\n\n  mounted() {\n    // 预加载 OpenCV.js\n    preloadOpenCV().catch(err => {\n      console.warn('OpenCV.js 预加载失败:', err)\n    })\n  },\n\n  beforeDestroy() {\n    this.stopCamera()\n  }\n}\n</script>\n\n<style src=\"./styles/index.css\"></style>\n\n<style scoped>\n/* ========================================\n   App 容器布局\n   ======================================== */\n.app-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background: var(--bg-primary);\n  background-image: \n    radial-gradient(ellipse at top, rgba(102, 126, 234, 0.15) 0%, transparent 50%),\n    radial-gradient(ellipse at bottom right, rgba(118, 75, 162, 0.1) 0%, transparent 50%);\n}\n\n/* ========================================\n   顶部标题栏\n   ======================================== */\n.app-header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.header-content {\n  max-width: 600px;\n  margin: 0 auto;\n  text-align: center;\n}\n\n.logo {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  margin-bottom: 4px;\n}\n\n.logo-icon {\n  width: 32px;\n  height: 32px;\n  color: var(--accent-color);\n}\n\n.logo-text {\n  font-size: 24px;\n  font-weight: 700;\n  background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.header-subtitle {\n  font-size: 14px;\n  color: var(--text-secondary);\n}\n\n/* ========================================\n   主内容区\n   ======================================== */\n.app-main {\n  flex: 1;\n  padding: 20px;\n  max-width: 600px;\n  margin: 0 auto;\n  width: 100%;\n}\n\n/* ========================================\n   模式切换\n   ======================================== */\n.mode-switcher {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.mode-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 14px 20px;\n  background: var(--bg-glass);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-lg);\n  color: var(--text-secondary);\n  font-size: 15px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all var(--transition-normal);\n  backdrop-filter: blur(10px);\n}\n\n.mode-btn svg {\n  width: 20px;\n  height: 20px;\n}\n\n.mode-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: var(--text-primary);\n}\n\n.mode-btn.active {\n  background: var(--primary-gradient);\n  border-color: transparent;\n  color: var(--text-primary);\n  box-shadow: var(--shadow-glow);\n}\n\n/* ========================================\n   摄像头区域\n   ======================================== */\n.camera-section {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.video-container {\n  position: relative;\n  width: 100%;\n  aspect-ratio: 4/3;\n  background: var(--bg-secondary);\n  border-radius: var(--radius-xl);\n  overflow: hidden;\n  border: 1px solid var(--border-color);\n}\n\n.video-preview,\n.result-canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n/* 扫描框叠加层 */\n.scan-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.3);\n}\n\n.scan-frame {\n  position: relative;\n  width: 70%;\n  max-width: 280px;\n  aspect-ratio: 1;\n  border: 2px solid rgba(0, 245, 160, 0.5);\n  border-radius: var(--radius-md);\n  animation: breathGlow 2s ease-in-out infinite;\n}\n\n.scan-corner {\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  border: 3px solid var(--accent-color);\n}\n\n.scan-corner.top-left {\n  top: -2px;\n  left: -2px;\n  border-right: none;\n  border-bottom: none;\n  border-top-left-radius: 8px;\n}\n\n.scan-corner.top-right {\n  top: -2px;\n  right: -2px;\n  border-left: none;\n  border-bottom: none;\n  border-top-right-radius: 8px;\n}\n\n.scan-corner.bottom-left {\n  bottom: -2px;\n  left: -2px;\n  border-right: none;\n  border-top: none;\n  border-bottom-left-radius: 8px;\n}\n\n.scan-corner.bottom-right {\n  bottom: -2px;\n  right: -2px;\n  border-left: none;\n  border-top: none;\n  border-bottom-right-radius: 8px;\n}\n\n.scan-line {\n  position: absolute;\n  left: 10%;\n  width: 80%;\n  height: 2px;\n  background: linear-gradient(90deg, transparent, var(--accent-color), transparent);\n  animation: scanLine 2s linear infinite;\n}\n\n/* 摄像头控制 */\n.camera-controls {\n  display: flex;\n  justify-content: center;\n  gap: 16px;\n}\n\n.capture-btn {\n  width: 72px;\n  height: 72px;\n  border-radius: 50%;\n  padding: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.capture-icon {\n  width: 48px;\n  height: 48px;\n  background: white;\n  border-radius: 50%;\n  transition: transform var(--transition-fast);\n}\n\n.capture-btn:hover .capture-icon {\n  transform: scale(0.9);\n}\n\n.result-controls {\n  display: flex;\n  gap: 12px;\n}\n\n/* ========================================\n   上传区域\n   ======================================== */\n.upload-section {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.upload-area {\n  position: relative;\n  width: 100%;\n  min-height: 300px;\n  background: var(--bg-secondary);\n  border: 2px dashed var(--border-color);\n  border-radius: var(--radius-xl);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all var(--transition-normal);\n  overflow: hidden;\n}\n\n.upload-area:hover {\n  border-color: var(--primary-color);\n  background: rgba(102, 126, 234, 0.05);\n}\n\n.upload-area.drag-over {\n  border-color: var(--accent-color);\n  background: rgba(0, 245, 160, 0.05);\n  box-shadow: inset 0 0 30px rgba(0, 245, 160, 0.1);\n}\n\n.upload-area.has-image {\n  border-style: solid;\n  cursor: default;\n}\n\n.upload-hint {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  padding: 40px;\n}\n\n.upload-icon {\n  width: 64px;\n  height: 64px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--bg-glass);\n  border-radius: 50%;\n  color: var(--primary-color);\n}\n\n.upload-icon svg {\n  width: 32px;\n  height: 32px;\n}\n\n.upload-text {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--text-primary);\n}\n\n.upload-subtext {\n  font-size: 14px;\n  color: var(--text-muted);\n}\n\n.upload-canvas {\n  width: 100%;\n  height: auto;\n  display: block;\n}\n\n.upload-controls {\n  display: flex;\n  justify-content: center;\n  gap: 12px;\n}\n\n/* ========================================\n   加载状态\n   ======================================== */\n.loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(15, 15, 35, 0.9);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  color: var(--text-secondary);\n}\n\n.loading-spinner {\n  width: 48px;\n  height: 48px;\n  border: 3px solid var(--border-color);\n  border-top-color: var(--accent-color);\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n/* ========================================\n   检测结果信息\n   ======================================== */\n.result-info {\n  margin-top: 20px;\n  padding: 20px;\n  border-radius: var(--radius-lg);\n}\n\n.result-header {\n  margin-bottom: 16px;\n}\n\n.result-status {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.result-status.success {\n  color: var(--accent-color);\n}\n\n.result-status.error {\n  color: #ff6b6b;\n}\n\n.result-details {\n  display: flex;\n  gap: 24px;\n  margin-bottom: 16px;\n  padding-bottom: 16px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.detail-item {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.detail-label {\n  font-size: 12px;\n  color: var(--text-muted);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.detail-value {\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--text-primary);\n  font-family: 'SF Mono', 'Fira Code', monospace;\n}\n\n.corner-coords h4 {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--text-secondary);\n  margin-bottom: 12px;\n}\n\n.coords-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 12px;\n}\n\n.coord-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 14px;\n  background: var(--bg-glass);\n  border-radius: var(--radius-sm);\n}\n\n.coord-label {\n  font-size: 13px;\n  color: var(--text-muted);\n}\n\n.coord-value {\n  font-size: 14px;\n  font-weight: 500;\n  color: var(--accent-color);\n  font-family: 'SF Mono', 'Fira Code', monospace;\n}\n\n.no-result-hint {\n  font-size: 14px;\n  color: var(--text-muted);\n}\n\n/* ========================================\n   错误提示\n   ======================================== */\n.error-message {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-top: 20px;\n  padding: 16px 20px;\n  border-radius: var(--radius-md);\n  background: rgba(255, 107, 107, 0.1);\n  border: 1px solid rgba(255, 107, 107, 0.3);\n  color: #ff6b6b;\n  font-size: 14px;\n}\n\n/* ========================================\n   底部信息\n   ======================================== */\n.app-footer {\n  padding: 16px 20px;\n  text-align: center;\n  color: var(--text-muted);\n  font-size: 12px;\n  border-top: 1px solid var(--border-color);\n}\n\n/* ========================================\n   响应式适配\n   ======================================== */\n@media (max-width: 480px) {\n  .app-header {\n    padding: 12px 16px;\n  }\n  \n  .logo-text {\n    font-size: 20px;\n  }\n  \n  .app-main {\n    padding: 16px;\n  }\n  \n  .mode-btn {\n    padding: 12px 16px;\n    font-size: 14px;\n  }\n  \n  .result-details {\n    flex-direction: column;\n    gap: 12px;\n  }\n  \n  .coords-grid {\n    grid-template-columns: 1fr;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}